<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Compress and Decompress XML</title>
  </head>
  <body>
    <textarea id="xmlInput" rows="10" cols="80">
<IDX=3,12><DAT DI="12" DT="0" FN="3000858204" TN="ПН 322948910136" V="1" ZN="КС00020959"><C T="0"><L N="1">00005 Каса Туманова А.Г. 01</L><L N="2"># ЧЕК N 14/3/9</L><P C="00000000000018" N="3" NM="Ц.КгTwix " PRC="15900" Q="152" SM="2417" TX="1"></P><P C="00000000000019" N="4" NM="Ц.КгBounty " PRC="15900" Q="158" SM="2512" TX="1"></P><P C="00000000000020" N="5" NM="Ц.4*50SnickersМолШок " SM="3490" TX="1"></P><L N="6">------------------------</L><L N="7">Спец пропозицiї та акцiї</L><L N="8">ТМ "Chef&Sommelier"</L><L N="9">Ваш баланс фiшок: 2.00</L><L N="10">------------------------</L><L N="11">До видачi 1 фiшок</L><L N="12">------------------------</L><L N="13">ЗАПРОШУЄМО НА РОБОТУ:</L><L N="14">* КАСИРА * ПРОДАВЦЯ</L><L N="15">* ВАНТАЖНИКА</L><L N="16">ТЕЛ: : 067-994-58-97</L><L N="17">------------------------</L><L N="18">22533544</L><L N="19">Баланс балiв на 04.12.20</L><L N="20">Загальний: 97</L><L N="21">------------------------</L><L N="22">Ваш бонус 4.81 грн</L><L N="23">------------------------</L><L N="24">Зараховано: 84</L><M N="25" NM="КАРТКА" SM="8419" T="2"></M><L N="26">Приват Банк</L><L N="27">Термiнал S1210EWN</L><L N="28">ОПЛАТА ЕПЗ VISA</L><L N="29">******XXXXXX7995</L><L N="30">Код авт.: 877219</L><L N="31">Пiдпис власника картки</L><L N="32">не потрiбен</L><E CS="1" FN="3000858204" N="33" NO="30" SE="7016" SM="8419" TS="20201210114940"><TX DTPR="0.00" DTSM="0" TX="1" TXAL="0" TXPR="20.00" TXSM="1403" TXTY="0"></TX></E></C><TS>20201210114940</TS></DAT> <MAC DI="12" NT="12">ABoAAAX3AAAAABQADk7KAAAACwABKopR3z8vIrA=</MAC>
  </textarea
    >
    <button onclick="compressAndStore()">Compress and Store</button>
    <button onclick="decompressAndDisplay()">Decompress and Display</button>
    <pre id="output"></pre>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.0.4/pako.min.js"></script>
    <script>
      let compressedDataArray = [];

      function compressAndStore() {
        const input = document.getElementById("xmlInput").value;
        const compressed = pako.deflate(input);
        const base64Compressed = arrayBufferToBase64(compressed);
        console.log(base64Compressed.length);
        console.log(input.length);
        compressedDataArray.push(base64Compressed);
        document.getElementById("output").textContent =
          "XML data compressed and stored successfully.";
      }

      function decompressAndDisplay() {
        if (compressedDataArray.length === 0) {
          document.getElementById("output").textContent =
            "No compressed data available.";
          return;
        }
        const base64Compressed = compressedDataArray[0];
        const compressed = base64ToArrayBuffer(base64Compressed);
        const decompressed = pako.inflate(compressed, { to: "string" });
        document.getElementById("output").textContent = decompressed;
      }

      function arrayBufferToBase64(buffer) {
        let binary = "";
        const bytes = new Uint8Array(buffer);
        const len = bytes.byteLength;
        for (let i = 0; i < len; i++) {
          binary += String.fromCharCode(bytes[i]);
        }
        return btoa(binary);
      }

      function base64ToArrayBuffer(base64) {
        const binaryString = atob(base64);
        const len = binaryString.length;
        const bytes = new Uint8Array(len);
        for (let i = 0; i < len; i++) {
          bytes[i] = binaryString.charCodeAt(i);
        }
        return bytes.buffer;
      }
    </script>
  </body>
</html>
